<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Temp</title>
<style>
<!-- -->
  body::-webkit-scrollbar {width: 10px; background-color: transparent; box-shadow: inset 1px 0px 0px 0px #00000029}
  body::-webkit-scrollbar-thumb {border-radius: 0px; border: none; background-color: #bababa}
  body::-webkit-scrollbar-thumb:hover {background-color: #afafaf}
  body::-webkit-scrollbar-thumb:active {background-color: #9d9d9d}

  body {
    margin: 0;
    background-color: #222;
    font-family: Arial, sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .page {flex: 1; display: flex; flex-direction: column; justify-content: space-between;}
  header, footer {width: 100%; background-color: #333; color: #fff; text-align: center;}
  footer {margin-top: auto; padding: 1rem 0;}

  .ba-slider {
    position: relative;
    display: flex;
    width: 100%;
    max-width: 100%;
    aspect-ratio: 3 / 2;
    overflow: hidden;
    cursor: pointer;
    user-select: none;
    margin: 0px;
  }

  .slider-group {overflow: hidden; height: 0;}
  .slider-group .ba-slider:not(:last-child) {border-bottom: 2px solid #5f5f5f}
  .img-wrapper {position: absolute; width: 100%; height: 100%; overflow: hidden;}
  .img-wrapper:nth-child(2) {clip-path: inset(0px 0px 0px 50%);}
  .img-wrapper img {width: 100%; height: 100%; object-fit: cover;}

  .line {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 6px;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(8px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 2;
  }

  .handle {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    height: 2.25rem;
    width: 2.25rem;
    background-color: rgba(55,55,55,0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.4);
    border-radius: 50%;
    box-shadow: inset 0 10px 20px rgba(255,255,255,0.6), 0 8px 20px rgba(0,0,0,0.4);
    z-index: 3;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .handle::before,
  .handle::after {
    content: '';
    display: block;
    width: 8px;
    height: 8px;
    border-top: 4px solid rgba(255,255,255,0.5);
    border-right: 4px solid rgba(255,255,255,0.5);
    border-radius: 2px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .handle::before {transform: rotate(-135deg);}
  .handle::after {transform: rotate(45deg);}

  input {display: none;}

details {
  display: block;
  margin: 1rem 1rem;
  max-width: 50rem;
  background-color: RGB(50,50,50);
  border: 2px solid #5f5f5f;
  border-radius: 6px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.4);
  transform-origin: center;
  color: #fff;
}

summary {
  user-select: none;
  cursor: pointer;
  color: #fff;
  font-weight: bold;
  text-align: center;
  padding: 8px 0px 8px 0px;
  background-color: rgba(55,55,55,0.2);
  backdrop-filter: blur(10px);
  border-radius: 4px;
  box-shadow:inset 0 10px 20px rgba(255,255,255,0.3),0 8px 20px rgba(0,0,0,0.4);
  transition: all 0.1s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
  width: 100%;
  box-sizing: border-box;
}



summary:hover {
  background-color: rgba(55,55,55,0.3);
  box-shadow:inset 0 12px 22px rgba(255,255,255,0.4), 0 10px 25px rgba(0,0,0,0.4);
}

summary:active {
  box-shadow:inset 0 10px 20px rgba(255,255,255,0.3);
}


details[open] summary {border-bottom-left-radius: 0; border-bottom-right-radius: 0}
summary::-webkit-details-marker {display: none;}
summary::marker {content: none;}
.slider-group {
  transform-origin: top;
  will-change: transform, opacity;
  transition: none; /* animations handled in JS */
}

.ba-slider {
  will-change: clip-path, left;
}

.handle, .line {
  will-change: transform;
}

</style>
</head>
<body>

<div class="page">
  <header>
    <h1>Entities by MiM</h1>
  </header>

  <details>
    <summary>Collapse</summary>
    <div class="slider-group">
      <div class="ba-slider" data-before="https://picsum.photos/id/1015/800/600" data-after="https://picsum.photos/id/1016/800/600"></div>
      <div class="ba-slider" data-before="https://picsum.photos/id/1020/800/600" data-after="https://picsum.photos/id/1021/800/600"></div>
      <div class="ba-slider" data-before="https://picsum.photos/id/1025/800/600" data-after="https://picsum.photos/id/1026/800/600"></div>

    </div>
  </details>

  <footer>
    <p>Thanks to friends below for helping me with testing c.c</p>
    <p>sockii, PNCKA_CTPOU, cris</p>
  </footer>
</div>


<script>
const sliderClickSpeed = 0.2, sliderDragSpeed = 0.5;
const spoilerWidthSpeed = 0.2, spoilerHeightSpeed = 0.5;

/* BEFORE/AFTER SLIDER */
class BeforeAfterSlider {
  constructor(container) {
    this.container = container;
    const beforeURL = container.dataset.before, afterURL = container.dataset.after;

    container.innerHTML = `
      <div class="img-wrapper"><img src="${beforeURL}" alt="Before"></div>
      <div class="img-wrapper"><img src="${afterURL}" alt="After"></div>
      <div class="line"></div><div class="handle"></div>
    `;


    this.handle = container.querySelector('.handle');
    this.line = container.querySelector('.line');
    this.imgAfter = container.querySelector('.img-wrapper:nth-of-type(2)');

    this.targetValue = 50;
    this.currentValue = this.targetValue;
    this.isDragging = false;
    this.mouseDown = false;

    this.addEventListeners();
    this.updateVisuals();
  }

  addEventListeners() {
    let dragDelayTimeout;
    this.container.addEventListener('mousedown', (e) => {
      if (e.button !== 0) return;
      e.preventDefault();
      const rect = this.container.getBoundingClientRect();
      let percent = ((e.clientX - rect.left) / rect.width) * 100;
      this.targetValue = Math.max(0, Math.min(100, percent));
      this.isDragging = false;
      this.mouseDown = true;
      clearTimeout(dragDelayTimeout);
      dragDelayTimeout = setTimeout(() => this.mouseDown && (this.isDragging = true), 150);
    });
    window.addEventListener('mouseup', () => {this.mouseDown = false; clearTimeout(dragDelayTimeout); this.isDragging = false});
    window.addEventListener('mousemove', (e) => {
      if (!this.mouseDown) return;
      const rect = this.container.getBoundingClientRect();
      let percent = ((e.clientX - rect.left) / rect.width) * 100;
      this.targetValue = Math.max(0, Math.min(100, percent));
    });
  }

  updateVisuals() {
      const speed = this.isDragging ? sliderDragSpeed : sliderClickSpeed;
      this.currentValue += (this.targetValue - this.currentValue) * speed;
      this.line.style.left = `${this.currentValue}%`;
      this.handle.style.left = `${this.currentValue}%`;
      this.imgAfter.style.clipPath = `inset(0px 0px 0px ${this.currentValue}%)`;
      requestAnimationFrame(() => this.updateVisuals());
  }
}

document.querySelectorAll('.ba-slider').forEach(slider => new BeforeAfterSlider(slider));

/* DETAILS TOGGLE ANIMATION */
document.querySelectorAll('details').forEach(detail => {
  const content = detail.querySelector('.slider-group');
  const summary = detail.querySelector('summary');
  if (!content || !summary) return;

  let animating = false;
  const easeInOutCubic = t => t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
  const animate = (duration, draw) => new Promise(resolve => {
    const start = performance.now();
    const step = time => {
      const progress = Math.min((time - start) / duration, 1);
      draw(easeInOutCubic(progress));
      if (progress < 1) requestAnimationFrame(step);
      else resolve();
    };
    requestAnimationFrame(step);
  });

  const updateOpenStyles = () => {
    if (!detail.open) return;
    const vw = window.innerWidth;
    const width = 0.9 * vw;
    detail.style.width = width + 'px';
  };

  // Initial state
  if (detail.open) {
    updateOpenStyles();
    summary.textContent = 'Collapse';
    content.style.height = content.scrollHeight + 'px';
    detail.style.borderBottomLeftRadius = '0px';
    detail.style.borderBottomRightRadius = '0px';
  } else {
    summary.textContent = 'Show more';
    detail.style.width = '120px';
    content.style.height = '0px';
    detail.style.borderBottomLeftRadius = '8px';
    detail.style.borderBottomRightRadius = '8px';
  }

  summary.addEventListener('click', async (e) => {
    e.preventDefault();
    if (animating) return;
    animating = true;

    const startWidth = detail.offsetWidth;
    const startMargin = parseFloat(getComputedStyle(detail).marginLeft);
    const vw = window.innerWidth;
    const targetWidth = 0.9 * vw;
    const targetMargin = 0.05 * vw;

    if (detail.open) {
      const startHeight = content.scrollHeight;
      await animate(spoilerHeightSpeed*1000, t => content.style.height = (startHeight * (1 - t)) + 'px');
      await animate(spoilerWidthSpeed*1000, t => {
        detail.style.width = startWidth + (120 - startWidth) * t + 'px';
        detail.style.marginLeft = startMargin + (16 - startMargin) * t + 'px';
        detail.style.marginRight = startMargin + (16 - startMargin) * t + 'px';
        detail.style.borderBottomLeftRadius = `${8 * t}px`;
        detail.style.borderBottomRightRadius = `${8 * t}px`;
      });
      detail.open = false;
      summary.textContent = 'Show more';
    } else {
      detail.open = true;
      summary.textContent = 'Collapse';
      await animate(spoilerWidthSpeed*1000, t => {
        detail.style.width = startWidth + (targetWidth - startWidth) * t + 'px';
        detail.style.marginRight = startMargin + (targetMargin - startMargin) * t + 'px';
        detail.style.borderBottomLeftRadius = `${8 * (1 - t)}px`;
        detail.style.borderBottomRightRadius = `${8 * (1 - t)}px`;
      });
      const targetHeight = content.scrollHeight;
      content.style.height = '0px';
      await animate(spoilerHeightSpeed*1000, t => content.style.height = (targetHeight * t) + 'px');
      content.style.height = 'auto';
    }

    animating = false;
  });

window.addEventListener('resize', updateOpenStyles);
});
</script>


</body>
</html>
